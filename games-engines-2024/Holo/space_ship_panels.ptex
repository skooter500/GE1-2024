{"name":"@@2656","type":"graph","parameters":{},"node_position":{"x":0,"y":0},"seed":0,"seed_locked":false,"label":"Graph","shortdesc":"","longdesc":"","nodes":[{"name":"Material","type":"material","parameters":{"albedo_color":{"type":"Color","r":1,"g":1,"b":1,"a":1},"metallic":0,"roughness":1,"emission_energy":1,"normal":1,"ao":1,"depth_scale":0.25,"flags_transparent":true,"sss":0,"size":11},"node_position":{"x":1431,"y":231},"seed":0,"seed_locked":false,"export_paths":{}},{"name":"bricks_uneven2","type":"bricks_uneven2","parameters":{"iterations":30,"min_size":0.1,"randomness":0.5,"mortar":0,"bevel":0.089,"round":0,"corner":0.09},"node_position":{"x":-635.5,"y":116.5},"seed":0,"seed_locked":false},{"name":"fill_to_random_grey_2","type":"fill_to_random_grey","parameters":{"edgecolor":1},"node_position":{"x":-253.5,"y":207.5},"seed":0,"seed_locked":false},{"name":"colorize","type":"colorize","parameters":{"gradient":{"type":"Gradient","points":[{"pos":0,"r":0.457031,"g":0.457031,"b":0.457031,"a":1},{"pos":1,"r":0.492188,"g":0.492188,"b":0.492188,"a":1}],"interpolation":1}},"node_position":{"x":78.5,"y":144.5},"seed":0,"seed_locked":false},{"name":"normal_map2","type":"normal_map2","parameters":{"param2":0,"size":11,"strength":1,"buffer":1},"node_position":{"x":405.5,"y":205.5},"seed":0,"seed_locked":false},{"name":"fill_to_gradient","type":"fill_to_gradient","parameters":{"grad":{"type":"Gradient","points":[{"pos":0,"r":0,"g":0,"b":0,"a":1},{"pos":1,"r":1,"g":1,"b":1,"a":1}],"interpolation":1},"mode":0,"layers":1,"rotate":0,"r_rotate":180,"r_offset":0},"node_position":{"x":-316.5,"y":329.5},"seed":0,"seed_locked":false},{"name":"blend","type":"blend","parameters":{"blend_type":2,"amount":0.04},"node_position":{"x":63.5,"y":373.5},"seed":0,"seed_locked":false},{"name":"fill_to_random_grey_3","type":"fill_to_random_grey","parameters":{"edgecolor":1},"node_position":{"x":-234.5,"y":100.5},"seed":0.476277,"seed_locked":false},{"name":"colorize_2","type":"colorize","parameters":{"gradient":{"type":"Gradient","points":[{"pos":0,"r":0.410156,"g":0.410156,"b":0.410156,"a":1},{"pos":1,"r":0.441406,"g":0.441406,"b":0.441406,"a":1}],"interpolation":1}},"node_position":{"x":245.5,"y":27.5},"seed":0,"seed_locked":false},{"name":"smooth_curvature2","type":"smooth_curvature2","parameters":{"param0":11,"param1":16,"param2":1.46,"param3":0.73,"param4":1},"node_position":{"x":419.5,"y":378.5},"seed":0,"seed_locked":false},{"name":"gradient","type":"gradient","parameters":{"repeat":1,"rotate":90,"gradient":{"type":"Gradient","points":[{"pos":0,"r":0,"g":0,"b":0,"a":1},{"pos":1,"r":1,"g":1,"b":1,"a":1}],"interpolation":1}},"node_position":{"x":-390.5,"y":892.25},"seed":0,"seed_locked":false},{"name":"tones_range","type":"tones_range","parameters":{"value":0.98,"width":0.02,"contrast":0,"invert":true},"node_position":{"x":-140.5,"y":904.25},"seed":0,"seed_locked":false},{"name":"math","type":"math","parameters":{"op":19,"default_in1":0,"default_in2":0,"clamp":false},"node_position":{"x":116.5,"y":907.25},"seed":0,"seed_locked":false},{"name":"invert","type":"invert","parameters":{},"node_position":{"x":409.5,"y":1037.25},"seed":0,"seed_locked":false},{"name":"mirror","type":"mirror","parameters":{"direction":1,"offset":0},"node_position":{"x":358.5,"y":908.25},"seed":0,"seed_locked":false},{"name":"blend_2","type":"blend","parameters":{"blend_type":2,"amount":0.8},"node_position":{"x":610.5,"y":844.25},"seed":0,"seed_locked":false},{"name":"colorize_4","type":"colorize","parameters":{"gradient":{"type":"Gradient","points":[{"pos":0.203822,"r":0.203822,"g":0.203822,"b":0.203822,"a":1},{"pos":0.859873,"r":0.859873,"g":0.859873,"b":0.859873,"a":1},{"pos":1,"r":1,"g":1,"b":1,"a":1}],"interpolation":1}},"node_position":{"x":-260.5,"y":395.25},"seed":0,"seed_locked":false},{"name":"custom_uv","type":"custom_uv","parameters":{"inputs":0,"sx":0.5,"sy":0.5,"rotate":180,"scale":0.15,"variations":false},"node_position":{"x":-152.5,"y":-137.75},"seed":0,"seed_locked":false},{"name":"shape","type":"shape","parameters":{"shape":1,"sides":6,"radius":0.85,"edge":1},"node_position":{"x":-564.5,"y":-124.75},"seed":0,"seed_locked":false},{"name":"fill_to_uv","type":"fill_to_uv","parameters":{"mode":0},"node_position":{"x":-393.5,"y":22.25},"seed":0,"seed_locked":false},{"name":"blend_3","type":"blend","parameters":{"blend_type":11,"amount":0.01},"node_position":{"x":2.5,"y":510.25},"seed":0,"seed_locked":false},{"name":"tiler","type":"tiler","parameters":{"tx":96,"ty":32,"overlap":1,"inputs":0,"scale_x":0.005,"scale_y":0.005,"fixed_offset":0,"offset":0,"rotate":0,"scale":0,"value":0,"variations":false},"node_position":{"x":-1024.5,"y":520.25},"seed":0,"seed_locked":false},{"name":"shape_2","type":"shape","parameters":{"shape":1,"sides":4,"radius":1,"edge":0.3},"node_position":{"x":-1323.5,"y":523.25},"seed":0,"seed_locked":false},{"name":"fbm2","type":"fbm2","parameters":{"noise":0,"scale_x":4,"scale_y":4,"folds":0,"iterations":5,"persistence":0.83,"offset":0},"node_position":{"x":-1304.5,"y":1020.25},"seed":0.190203,"seed_locked":false},{"name":"tones_step","type":"tones_step","parameters":{"value":0.51,"width":0,"invert":false},"node_position":{"x":-1024.5,"y":1056.25},"seed":0,"seed_locked":false},{"name":"math_2","type":"math","parameters":{"op":13,"default_in1":0,"default_in2":0,"clamp":false},"node_position":{"x":-728.5,"y":851.25},"seed":0,"seed_locked":false},{"name":"tones_step_2","type":"tones_step","parameters":{"value":0.99,"width":0,"invert":false},"node_position":{"x":-668.5,"y":591.25},"seed":0,"seed_locked":false},{"name":"invert_2","type":"invert","parameters":{},"node_position":{"x":-701.5,"y":395.25},"seed":0,"seed_locked":false},{"name":"blend_4","type":"blend","parameters":{"blend_type":2,"amount":0.15},"node_position":{"x":9.5,"y":642.25},"seed":0,"seed_locked":false},{"name":"decompose","type":"decompose","parameters":{},"node_position":{"x":-1331.5,"y":234.25},"seed":0,"seed_locked":false},{"name":"tones_step_3","type":"tones_step","parameters":{"value":0.5,"width":0,"invert":false},"node_position":{"x":-1130.5,"y":212.25},"seed":0,"seed_locked":false},{"name":"colorize_5","type":"colorize","parameters":{"gradient":{"type":"Gradient","points":[{"pos":0,"r":0.332031,"g":0.671234,"b":1,"a":1},{"pos":1,"r":1,"g":0.800781,"b":0.203125,"a":1}],"interpolation":1}},"node_position":{"x":-1137.5,"y":84.25},"seed":0,"seed_locked":false},{"name":"blend_5","type":"blend","parameters":{"blend_type":2,"amount":1},"node_position":{"x":-904.5,"y":50.25},"seed":0,"seed_locked":false},{"name":"tones_step_4","type":"tones_step","parameters":{"value":0.99,"width":0,"invert":false},"node_position":{"x":-730.5,"y":461.25},"seed":0,"seed_locked":false},{"name":"blend_6","type":"blend","parameters":{"blend_type":0,"amount":1},"node_position":{"x":835.5,"y":364.25},"seed":0,"seed_locked":false},{"name":"uniform","type":"uniform","parameters":{"color":{"type":"Color","r":0,"g":0,"b":0,"a":1}},"node_position":{"x":830.5,"y":-51.75},"seed":0,"seed_locked":false},{"name":"blend_7","type":"blend","parameters":{"blend_type":2,"amount":1},"node_position":{"x":-869.5,"y":240.25},"seed":0,"seed_locked":false},{"name":"blend_8","type":"blend","parameters":{"blend_type":0,"amount":1},"node_position":{"x":394.5,"y":-163.75},"seed":0,"seed_locked":false},{"name":"uniform_greyscale","type":"uniform_greyscale","parameters":{"color":0.17},"node_position":{"x":390.5,"y":-266.75},"seed":0,"seed_locked":false},{"name":"colorize_6","type":"colorize","parameters":{"gradient":{"type":"Gradient","points":[{"pos":0,"r":1,"g":1,"b":1,"a":1},{"pos":1,"r":0,"g":0,"b":0,"a":1}],"interpolation":1}},"node_position":{"x":395.5,"y":612.25},"seed":0,"seed_locked":false},{"name":"blend_9","type":"blend","parameters":{"blend_type":2,"amount":1},"node_position":{"x":-295.5,"y":-304.75},"seed":0,"seed_locked":false},{"name":"uniform_greyscale_2","type":"uniform_greyscale","parameters":{"color":2},"node_position":{"x":-548.5,"y":-340.75},"seed":0,"seed_locked":false},{"name":"tones_step_5","type":"tones_step","parameters":{"value":0.99,"width":0,"invert":false},"node_position":{"x":-132.5,"y":1064.25},"seed":0,"seed_locked":false},{"name":"math_3","type":"math","parameters":{"op":13,"default_in1":0,"default_in2":0,"clamp":false},"node_position":{"x":-762.5,"y":1010.25},"seed":0,"seed_locked":false},{"name":"math_4","type":"math","parameters":{"op":19,"default_in1":0,"default_in2":0,"clamp":false},"node_position":{"x":-1471.5,"y":1430.25},"seed":0,"seed_locked":false},{"name":"bricks_uneven2_2","type":"bricks_uneven2","parameters":{"iterations":9,"min_size":0.32,"randomness":0.69,"mortar":0,"bevel":0.153,"round":0,"corner":0.3},"node_position":{"x":-1752.5,"y":1445.25},"seed":0.904653,"seed_locked":false},{"name":"variations_greyscale","type":"variations_greyscale","parameters":{"v1":0,"v2":0.1,"v3":0.2,"v4":0.3,"v5":0.4},"node_position":{"x":-1212.5,"y":1467.25},"seed":0,"seed_locked":false},{"name":"colorize_3","type":"colorize","parameters":{"gradient":{"type":"Gradient","points":[{"pos":0,"r":0,"g":0,"b":0,"a":1},{"pos":1,"r":0.273438,"g":0.273438,"b":0.273438,"a":1}],"interpolation":1}},"node_position":{"x":-1049.5,"y":1444.25},"seed":0,"seed_locked":false},{"name":"colorize_7","type":"colorize","parameters":{"gradient":{"type":"Gradient","points":[{"pos":0,"r":0,"g":0,"b":0,"a":1},{"pos":0.018182,"r":0.265625,"g":0.265625,"b":0.265625,"a":1},{"pos":1,"r":0.527344,"g":0.527344,"b":0.527344,"a":1}],"interpolation":1}},"node_position":{"x":-1047.5,"y":1517.75},"seed":0,"seed_locked":false},{"name":"colorize_8","type":"colorize","parameters":{"gradient":{"type":"Gradient","points":[{"pos":0,"r":0,"g":0,"b":0,"a":1},{"pos":0.018182,"r":0.496094,"g":0.496094,"b":0.496094,"a":1},{"pos":1,"r":0.726562,"g":0.726562,"b":0.726562,"a":1}],"interpolation":1}},"node_position":{"x":-1048.5,"y":1593.75},"seed":0,"seed_locked":false},{"name":"colorize_9","type":"colorize","parameters":{"gradient":{"type":"Gradient","points":[{"pos":0,"r":0,"g":0,"b":0,"a":1},{"pos":0.018182,"r":0.722656,"g":0.722656,"b":0.722656,"a":1},{"pos":1,"r":1,"g":1,"b":1,"a":1}],"interpolation":1}},"node_position":{"x":-1047.5,"y":1675.75},"seed":0,"seed_locked":false},{"name":"math_5","type":"math","parameters":{"op":14,"default_in1":0,"default_in2":0,"clamp":false},"node_position":{"x":-825.5,"y":1394.25},"seed":0,"seed_locked":false},{"name":"math_6","type":"math","parameters":{"op":14,"default_in1":0,"default_in2":0,"clamp":false},"node_position":{"x":-825.5,"y":1608.25},"seed":0,"seed_locked":false},{"name":"math_7","type":"math","parameters":{"op":14,"default_in1":0,"default_in2":0,"clamp":false},"node_position":{"x":-554.5,"y":1454.25},"seed":0,"seed_locked":false},{"name":"custom_uv_2","type":"custom_uv","parameters":{"inputs":0,"sx":1,"sy":1,"rotate":0,"scale":0.2,"variations":true},"node_position":{"x":-218.5,"y":1326.25},"seed":0,"seed_locked":false},{"name":"fill_to_uv_2","type":"fill_to_uv","parameters":{"mode":1},"node_position":{"x":-156.5,"y":1196.25},"seed":0,"seed_locked":false},{"name":"fill_to_random_grey_4","type":"fill_to_random_grey","parameters":{"edgecolor":1},"node_position":{"x":-318.5,"y":620.25},"seed":0.290341,"seed_locked":false},{"name":"tones_step_6","type":"tones_step","parameters":{"value":0.02,"width":0,"invert":false},"node_position":{"x":-296.5,"y":711.25},"seed":0,"seed_locked":false},{"name":"math_8","type":"math","parameters":{"op":13,"default_in1":0,"default_in2":0,"clamp":false},"node_position":{"x":-711.5,"y":1165.25},"seed":0,"seed_locked":false},{"name":"blend_10","type":"blend","parameters":{"blend_type":2,"amount":0.3},"node_position":{"x":67.5,"y":242.25},"seed":0,"seed_locked":false},{"name":"math_9","type":"math","parameters":{"op":14,"default_in1":0,"default_in2":0,"clamp":false},"node_position":{"x":336.5,"y":1242.25},"seed":0,"seed_locked":false},{"name":"colorize_10","type":"colorize","parameters":{"gradient":{"type":"Gradient","points":[{"pos":0,"r":0.328125,"g":0.328125,"b":0.328125,"a":1},{"pos":1,"r":0.417969,"g":0.417969,"b":0.417969,"a":1}],"interpolation":1}},"node_position":{"x":101.5,"y":1474.25},"seed":0,"seed_locked":false},{"name":"blend_11","type":"blend","parameters":{"blend_type":0,"amount":1},"node_position":{"x":1002.5,"y":1152.25},"seed":0,"seed_locked":false},{"name":"invert_3","type":"invert","parameters":{},"node_position":{"x":785.5,"y":634.25},"seed":0,"seed_locked":false},{"name":"colorize_11","type":"colorize","parameters":{"gradient":{"type":"Gradient","points":[{"pos":0,"r":0.116516,"g":0.132309,"b":0.179688,"a":1},{"pos":1,"r":0.169327,"g":0.195755,"b":0.316406,"a":1}],"interpolation":1}},"node_position":{"x":531.5,"y":1584.25},"seed":0,"seed_locked":false},{"name":"graph_6","type":"graph","parameters":{"param0":12,"param1":0.1,"param2":15,"param3":0.08,"param4":4,"param5":1},"node_position":{"x":636.5,"y":1003.25},"seed":6741,"seed_locked":false,"label":"HBAO","shortdesc":"","longdesc":"","nodes":[{"name":"voronoi_3","type":"shader","parameters":{"radius":0.1,"angleBiasDeg":15,"intensity":1,"depth_scale":0.08,"quality":4},"node_position":{"x":-600.80072,"y":-894.601807},"seed":49449,"seed_locked":false,"shader_model":{"code":"","global":"","inputs":[{"default":"0.0","function":true,"label":"","name":"in","type":"f"}],"instance":"//inspired by:\n//http://developer.download.nvidia.com/presentations/2008/SIGGRAPH/HBAO_SIG08b.pdf\n//https://gist.github.com/dotModded/981206ae1f4e760b7348\n//https://github.com/scanberg/hbao/blob/master/resources/shaders/hbao_full_frag.glsl\n//radius - radius of influence in screen space\n//angleBiasDeg - ~minimum angle for AO\n//intensity - increase strength of caclulated AO\n//noiseScale - for randomization values\nfloat $(name)_hbao(vec2 uv, float radius, float angleBiasDeg, float intensity, vec2 noiseScale) {\n  int samplig_directions = 8;\n  int steps = int($quality);\n\n  float angleBias = 0.0174532925 * angleBiasDeg;\n\n  vec3 c_point = vec3(uv*2.0 - 1.0, $in(uv)*$depth_scale);\n  //fun with dfdx & dfdy - https://community.khronos.org/t/getting-the-normal-with-dfdx-and-dfdy/70177\n  vec3 c_normal = normalize(cross(dFdx(c_point), dFdy(c_point)));\n\n\n  float cosMaxRot = cos(6.28318530718 / float(samplig_directions));\n  float sinMaxROt = sin(6.28318530718 / float(samplig_directions));\n  \n  // it should be faster than standard rotation in each iteartion\n  mat2 deltaRotationMatrix = mat2(\n    vec2(cosMaxRot, -sinMaxROt),\n    vec2(sinMaxROt, cosMaxRot)\n  );\n  \n  // calculate starting offset, as the smallest step\n  vec2 offset_uv = vec2(1.0, 0.0) * (radius /float(steps));\n\n  //randomize angle\n  vec3 sampleNoise    = rand3(uv * noiseScale);\n  sampleNoise.xy      = sampleNoise.xy * 2.0 - vec2(1.0);\n  mat2 rotationMatrix = mat2(vec2(sampleNoise.x, -sampleNoise.y), \n                             vec2(sampleNoise.y,  sampleNoise.x));\n  \n  // apply a random rotation to the base step vector\n  offset_uv = rotationMatrix * offset_uv;\n  \n  float jitter = sampleNoise.z;\n  float occlusion = 0.0;\n  \n  for (int i = 0; i < samplig_directions; ++i) {\n    // incrementally rotate sample direction\n    offset_uv = deltaRotationMatrix * offset_uv;\n    float oldAngle   = angleBias;\n    for (int j = 0; j < steps; ++j) {\n      //add jitter & distance to offset UV\n      vec2 sample_uv     = uv + (jitter + float(j)) * offset_uv;\n      vec3 s_point     = vec3(sample_uv*2.0 - 1.0, $in(sample_uv)*$depth_scale);\n      vec3 sample_tan  = (s_point - c_point); //not sure if correct, but looks ok\n      // 90 deg - (angle between normal from current point &  sampled tangent)\n      //https://math.stackexchange.com/questions/654315/how-to-convert-a-dot-product-of-two-vectors-to-the-angle-between-the-vectors\n      float gamma = 1.57079632679 - acos(dot(c_normal, normalize(sample_tan)));\n      \n      if (gamma > oldAngle) {\n        float value = sin(gamma) - sin(oldAngle);\n        float attenuation = clamp(1.0 - pow(length(sample_tan.xy)/radius, 2.0), 0.0, 1.0);\n        occlusion += attenuation * value;\n\t\t//occlusion += value;\n        oldAngle = gamma;\n      }\n    }\n  }\n  \n  occlusion = 1.0 - occlusion / float(samplig_directions);\n  return clamp(pow(occlusion, 1.0 + intensity), 0.0, 1.0);\n}","longdesc":"A node that generates several images from a tileable voronoi noise","name":"HBAO","outputs":[{"f":"$(name)_hbao($uv,$radius, $angleBiasDeg, $intensity, vec2(16.0,16.0))","longdesc":"A color pattern that assigns a random color to each cell","shortdesc":"Random color","type":"f"}],"parameters":[{"control":"None","default":0.01,"label":"Radius","longdesc":"The scale along the X axis","max":1,"min":0,"name":"radius","shortdesc":"Scale.x","step":0.01,"type":"float"},{"control":"None","default":30,"label":"Angle Bias","longdesc":"Angle bias for AO","max":90,"min":0,"name":"angleBiasDeg","shortdesc":"Angle Bias","step":1,"type":"float"},{"control":"None","default":0.2,"label":"Intensity","longdesc":"Change intensity of AO","max":5,"min":0,"name":"intensity","shortdesc":"Intensity","step":0.01,"type":"float"},{"control":"None","default":1,"label":"Depth Scale","longdesc":"Lineary scales depth values afecting  cacluated normals & tangents","max":1,"min":0,"name":"depth_scale","shortdesc":"Depth Scale","step":0.01,"type":"float"},{"control":"None","default":4,"label":"Steps","longdesc":"Steps in given direction per ray","max":12,"min":1,"name":"quality","shortdesc":"Quality","step":1,"type":"float"}],"shortdesc":"Voronoi Noise"}},{"name":"gen_inputs","type":"ios","parameters":{},"node_position":{"x":-1338.030762,"y":-788.080872},"seed":43798,"seed_locked":false,"ports":[{"group_size":0,"longdesc":"Greyscale heightmap","name":"input","shortdesc":"Input","type":"f"}]},{"name":"gen_outputs","type":"ios","parameters":{},"node_position":{"x":-902.684204,"y":-327.282288},"seed":42623,"seed_locked":false,"ports":[{"group_size":0,"longdesc":"","name":"port0","shortdesc":"AO","type":"f"}]},{"name":"gen_parameters","type":"remote","parameters":{"param0":12,"param1":0.1,"param2":15,"param3":0.08,"param4":4,"param5":1},"node_position":{"x":-1488.979004,"y":-561.71167},"seed":58911,"seed_locked":false,"widgets":[{"label":"Size","linked_widgets":[{"node":"voronoi_2","widget":"size"},{"node":"buffer_2","widget":"size"},{"node":"buffer_5","widget":"size"},{"node":"buffer_7","widget":"size"}],"name":"param0","shortdesc":"Size","type":"linked_control"},{"label":"Radius","linked_widgets":[{"node":"voronoi_3","widget":"radius"}],"longdesc":"Affected radius of point in UV size","name":"param1","shortdesc":"Radius","type":"linked_control"},{"label":"Angle Bias","linked_widgets":[{"node":"voronoi_3","widget":"angleBiasDeg"}],"longdesc":"Minimum angle on heightmap for AO to occur. Angle is calculated in UV space, where depth (grayscale input) is scaled by \"Depth Scale\" parameter","name":"param2","shortdesc":"Angle bias","type":"linked_control"},{"label":"Depth Scale","linked_widgets":[{"node":"voronoi_3","widget":"depth_scale"}],"longdesc":"Lineary scales depth values afecting  cacluated normals & tangents","name":"param3","shortdesc":"Depth Scale","type":"linked_control"},{"label":"Quality","linked_widgets":[{"node":"voronoi_3","widget":"quality"}],"longdesc":"Number of steps per direction sampling","name":"param4","shortdesc":"Quality","type":"linked_control"},{"label":"Intensity","linked_widgets":[{"node":"voronoi_3","widget":"intensity"}],"longdesc":"Change intensity of calculated AO","name":"param5","shortdesc":"Intensity","type":"linked_control"}]},{"name":"voronoi_2","type":"shader","parameters":{"size":12,"sigma":3,"ksigma":4,"threshold":0.7},"node_position":{"x":-710.111145,"y":-596.459534},"seed":38722,"seed_locked":false,"shader_model":{"code":"","global":"","inputs":[{"default":"0.0","function":true,"label":"","name":"in","type":"rgba"}],"instance":"//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n//  Copyright (c) 2018-2019 Michele Morrone\n//  All rights reserved.\n//\n//  https://michelemorrone.eu - https://BrutPitt.com\n//\n//  me@michelemorrone.eu - brutpitt@gmail.com\n//  twitter: @BrutPitt - github: BrutPitt\n//  \n//  https://github.com/BrutPitt/glslSmartDeNoise/\n//\n//  This software is distributed under the terms of the BSD 2-Clause license\n//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n//  smartDeNoise - parameters\n//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n//\n//  sampler2D tex     - sampler image / texture\n//  vec2 uv           - actual fragment coord\n//  float sigma  >  0 - sigma Standard Deviation\n//  float kSigma >= 0 - sigma coefficient \n//      kSigma * sigma  -->  radius of the circular kernel\n//  float threshold   - edge sharpening threshold \nvec4 $(name)_smartDeNoise(vec2 uv, float sigma, float kSigma, float threshold)\n{\n\tfloat INV_SQRT_OF_2PI = 0.39894228040143267793994605993439; // 1.0/SQRT_OF_2PI\n\tfloat INV_PI = 0.31830988618379067153776752674503;\n    float radius = round(kSigma*sigma);\n    float radQ = radius * radius;\n\n    float invSigmaQx2 = .5 / (sigma * sigma);      // 1.0 / (sigma^2 * 2.0)\n    float invSigmaQx2PI = INV_PI * invSigmaQx2;    // 1/(2 * PI * sigma^2)\n\n    float invThresholdSqx2 = .5 / (threshold * threshold);     // 1.0 / (sigma^2 * 2.0)\n    float invThresholdSqrt2PI = INV_SQRT_OF_2PI / threshold;   // 1.0 / (sqrt(2*PI) * sigma^2)\n\n    vec4 centrPx = $in(uv); \n\n    float zBuff = 0.0;\n    vec4 aBuff = vec4(0.0);\n    vec2 size = vec2($size, $size);\n\n    vec2 d;\n    for (d.x=-radius; d.x <= radius; d.x++) {\n        float pt = sqrt(radQ-d.x*d.x);       // pt = yRadius: have circular trend\n        for (d.y=-pt; d.y <= pt; d.y++) {\n            float blurFactor = exp( -dot(d , d) * invSigmaQx2 ) * invSigmaQx2PI;\n\n            vec4 walkPx =  $in(uv+d/size);\n            vec4 dC = walkPx-centrPx;\n            float deltaFactor = exp( -dot(dC, dC) * invThresholdSqx2) * invThresholdSqrt2PI * blurFactor;\n\n            zBuff += deltaFactor;\n            aBuff += deltaFactor*walkPx;\n        }\n    }\n    return aBuff/zBuff;\n}","longdesc":"A node that generates several images from a tileable voronoi noise","name":"Denoiser","outputs":[{"longdesc":"A color pattern that assigns a random color to each cell","rgba":"$(name)_smartDeNoise($uv, $sigma, $ksigma, $threshold)","shortdesc":"Random color","type":"rgba"}],"parameters":[{"default":10,"first":0,"label":"size","last":12,"longdesc":"The scale along the X axis","name":"size","shortdesc":"Scale.x","type":"size"},{"control":"None","default":0.5,"label":"Sigma","max":1,"min":0.005,"name":"sigma","step":0.1,"type":"float"},{"control":"None","default":0.5,"label":"kSigma","max":1,"min":0,"name":"ksigma","step":0.1,"type":"float"},{"control":"None","default":0.5,"label":"threshold","max":1,"min":0,"name":"threshold","step":0.1,"type":"float"}],"shortdesc":"Voronoi Noise"}},{"name":"buffer_5","type":"buffer","parameters":{"size":12},"node_position":{"x":-931.449646,"y":-724.330017},"seed":6771,"seed_locked":false,"version":1},{"name":"buffer_7","type":"buffer","parameters":{"size":12},"node_position":{"x":-948.36377,"y":-449.796295},"seed":16139,"seed_locked":false,"version":1},{"name":"buffer_2","type":"buffer","parameters":{"size":12},"node_position":{"x":-976.009644,"y":-975.5},"seed":42465,"seed_locked":false,"version":1}],"connections":[{"from":"voronoi_3","from_port":0,"to":"buffer_5","to_port":0},{"from":"voronoi_2","from_port":0,"to":"buffer_7","to_port":0},{"from":"buffer_7","from_port":0,"to":"gen_outputs","to_port":0},{"from":"gen_inputs","from_port":0,"to":"buffer_2","to_port":0},{"from":"buffer_2","from_port":0,"to":"voronoi_3","to_port":0},{"from":"buffer_5","from_port":0,"to":"voronoi_2","to_port":0}]},{"name":"blend_12","type":"blend","parameters":{"blend_type":2,"amount":0.61},"node_position":{"x":1180.5,"y":824.25},"seed":0,"seed_locked":false}],"connections":[{"from":"bricks_uneven2","from_port":1,"to":"fill_to_random_grey_2","to_port":0},{"from":"fill_to_random_grey_2","from_port":0,"to":"colorize","to_port":0},{"from":"normal_map2","from_port":0,"to":"Material","to_port":4},{"from":"bricks_uneven2","from_port":1,"to":"fill_to_gradient","to_port":0},{"from":"fill_to_gradient","from_port":0,"to":"blend","to_port":0},{"from":"bricks_uneven2","from_port":1,"to":"fill_to_random_grey_3","to_port":0},{"from":"fill_to_random_grey_3","from_port":0,"to":"colorize_2","to_port":0},{"from":"blend","from_port":0,"to":"smooth_curvature2","to_port":0},{"from":"gradient","from_port":0,"to":"tones_range","to_port":0},{"from":"tones_range","from_port":0,"to":"math","to_port":0},{"from":"math","from_port":0,"to":"mirror","to_port":0},{"from":"mirror","from_port":0,"to":"invert","to_port":0},{"from":"invert","from_port":0,"to":"blend_2","to_port":0},{"from":"shape","from_port":0,"to":"custom_uv","to_port":0},{"from":"bricks_uneven2","from_port":2,"to":"fill_to_uv","to_port":0},{"from":"fill_to_uv","from_port":0,"to":"custom_uv","to_port":1},{"from":"blend","from_port":0,"to":"blend_3","to_port":1},{"from":"custom_uv","from_port":0,"to":"blend_3","to_port":0},{"from":"shape_2","from_port":0,"to":"tiler","to_port":0},{"from":"fbm2","from_port":0,"to":"tones_step","to_port":0},{"from":"tones_step","from_port":0,"to":"math_2","to_port":1},{"from":"bricks_uneven2","from_port":0,"to":"tones_step_2","to_port":0},{"from":"tones_step_2","from_port":0,"to":"math_2","to_port":0},{"from":"tiler","from_port":0,"to":"invert_2","to_port":0},{"from":"invert_2","from_port":0,"to":"blend_4","to_port":0},{"from":"tiler","from_port":1,"to":"decompose","to_port":0},{"from":"decompose","from_port":0,"to":"tones_step_3","to_port":0},{"from":"decompose","from_port":1,"to":"colorize_5","to_port":0},{"from":"colorize_5","from_port":0,"to":"blend_5","to_port":0},{"from":"tones_step_3","from_port":0,"to":"blend_5","to_port":1},{"from":"tiler","from_port":0,"to":"tones_step_4","to_port":0},{"from":"smooth_curvature2","from_port":0,"to":"blend_6","to_port":1},{"from":"tones_step_4","from_port":0,"to":"blend_6","to_port":2},{"from":"uniform","from_port":0,"to":"blend_6","to_port":0},{"from":"blend_5","from_port":0,"to":"blend_7","to_port":1},{"from":"tones_step_4","from_port":0,"to":"blend_7","to_port":0},{"from":"colorize_2","from_port":0,"to":"blend_8","to_port":1},{"from":"tones_step_4","from_port":0,"to":"blend_8","to_port":2},{"from":"uniform_greyscale","from_port":0,"to":"blend_8","to_port":0},{"from":"blend_7","from_port":0,"to":"blend_9","to_port":1},{"from":"uniform_greyscale_2","from_port":0,"to":"blend_9","to_port":0},{"from":"blend_9","from_port":0,"to":"Material","to_port":3},{"from":"colorize_6","from_port":0,"to":"Material","to_port":6},{"from":"math_2","from_port":0,"to":"math_3","to_port":0},{"from":"tones_step_5","from_port":0,"to":"math_3","to_port":1},{"from":"invert","from_port":0,"to":"tones_step_5","to_port":0},{"from":"blend_4","from_port":0,"to":"blend_2","to_port":1},{"from":"blend_2","from_port":0,"to":"colorize_6","to_port":0},{"from":"blend_2","from_port":0,"to":"normal_map2","to_port":0},{"from":"bricks_uneven2_2","from_port":0,"to":"math_4","to_port":0},{"from":"math_4","from_port":0,"to":"variations_greyscale","to_port":0},{"from":"variations_greyscale","from_port":0,"to":"colorize_3","to_port":0},{"from":"variations_greyscale","from_port":1,"to":"colorize_7","to_port":0},{"from":"variations_greyscale","from_port":2,"to":"colorize_8","to_port":0},{"from":"variations_greyscale","from_port":3,"to":"colorize_9","to_port":0},{"from":"colorize_3","from_port":0,"to":"math_5","to_port":0},{"from":"colorize_7","from_port":0,"to":"math_5","to_port":1},{"from":"colorize_8","from_port":0,"to":"math_6","to_port":0},{"from":"colorize_9","from_port":0,"to":"math_6","to_port":1},{"from":"math_5","from_port":0,"to":"math_7","to_port":0},{"from":"math_6","from_port":0,"to":"math_7","to_port":1},{"from":"bricks_uneven2","from_port":1,"to":"fill_to_uv_2","to_port":0},{"from":"fill_to_uv_2","from_port":0,"to":"custom_uv_2","to_port":1},{"from":"math_7","from_port":0,"to":"custom_uv_2","to_port":0},{"from":"bricks_uneven2","from_port":1,"to":"fill_to_random_grey_4","to_port":0},{"from":"fill_to_random_grey_4","from_port":0,"to":"tones_step_6","to_port":0},{"from":"math_3","from_port":0,"to":"math_8","to_port":0},{"from":"tones_step_6","from_port":0,"to":"math_8","to_port":1},{"from":"math_8","from_port":0,"to":"tiler","to_port":1},{"from":"colorize","from_port":0,"to":"blend_10","to_port":1},{"from":"tones_step_6","from_port":0,"to":"blend_10","to_port":0},{"from":"blend_10","from_port":0,"to":"blend","to_port":1},{"from":"blend_3","from_port":0,"to":"math_9","to_port":0},{"from":"custom_uv_2","from_port":0,"to":"colorize_10","to_port":0},{"from":"colorize_10","from_port":0,"to":"math_9","to_port":1},{"from":"math_9","from_port":0,"to":"blend_4","to_port":1},{"from":"blend_6","from_port":0,"to":"blend_11","to_port":1},{"from":"blend_11","from_port":0,"to":"Material","to_port":0},{"from":"tones_step_6","from_port":0,"to":"invert_3","to_port":0},{"from":"invert_3","from_port":0,"to":"Material","to_port":1},{"from":"custom_uv_2","from_port":0,"to":"colorize_11","to_port":0},{"from":"colorize_11","from_port":0,"to":"blend_11","to_port":0},{"from":"invert_3","from_port":0,"to":"blend_11","to_port":2},{"from":"blend_2","from_port":0,"to":"graph_6","to_port":0},{"from":"graph_6","from_port":0,"to":"Material","to_port":5},{"from":"blend_8","from_port":0,"to":"blend_12","to_port":1},{"from":"tones_step_6","from_port":0,"to":"blend_12","to_port":0},{"from":"blend_12","from_port":0,"to":"Material","to_port":2}]}